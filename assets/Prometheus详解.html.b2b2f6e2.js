import{r as e,o as p,a as t,b as n,d as l,F as c,e as s,c as o}from"./app.897a2dcd.js";import{_ as r}from"./plugin-vue_export-helper.21dcd24c.js";const u={},i=n("h1",{id:"prometheus\u8BE6\u89E3",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#prometheus\u8BE6\u89E3","aria-hidden":"true"},"#"),s(" Prometheus\u8BE6\u89E3")],-1),k={id:"\u5B98\u65B9\u6587\u6863",tabindex:"-1"},b=n("a",{class:"header-anchor",href:"#\u5B98\u65B9\u6587\u6863","aria-hidden":"true"},"#",-1),m=s(),d={href:"https://prometheus.io/docs/prometheus/latest/getting_started/",target:"_blank",rel:"noopener noreferrer"},h=s("\u5B98\u65B9\u6587\u6863"),_=o(`<h2 id="\u4E09\u5927\u5757\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#\u4E09\u5927\u5757\u529F\u80FD" aria-hidden="true">#</a> \u4E09\u5927\u5757\u529F\u80FD</h2><ul><li>\u91C7\u96C6\u6307\u6807 <ul><li>scrape_configs</li></ul></li><li>\u5339\u914D\u544A\u8B66\u89C4\u5219\u5E76\u8BA1\u7B97 <ul><li>rule_files</li><li>evaluation_interval</li></ul></li><li>\u53D1\u9001\u544A\u8B66\u7ED9Alertmanager <ul><li>alertmanagers</li></ul></li></ul><h2 id="\u6211\u4EEC\u7684\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u6211\u4EEC\u7684\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u6211\u4EEC\u7684\u914D\u7F6E\u6587\u4EF6</h2><blockquote><p>\u8FD9\u662F\u6211\u4EEC\u76EE\u524D\u7EBF\u4E0APrometheus\u90E8\u5206\u914D\u7F6E\u6587\u4EF6, \u53EF\u4EE5\u5927\u6982\u770B\u4E0B\u4E3B\u8981\u7684\u914D\u7F6E\u4EE5\u53CA\u4F7F\u7528\u7684\u65B9\u5F0F, \u90E8\u5206\u8BF4\u660E\u4E5F\u5728\u4E0B\u9762\u6CE8\u91CA\u4F53\u73B0</p></blockquote><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># global\u7684\u5168\u5C40\u914D\u7F6E</span>
<span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 60s <span class="token comment"># \u4EFB\u52A1\u6293\u53D6\u5468\u671F, \u6BCF\u969460\u79D2\u53BB\u5404\u4E2A\u88AB\u76D1\u63A7\u7AEF\u70B9\u62C9\u53D6\u4E00\u6B21\u6307\u6807\u6570\u636E</span>
  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 60s <span class="token comment"># \u8BA1\u7B97\u5468\u671F, \u4E3B\u8981\u9488\u5BF9\u4E0B\u9762\u7684\u544A\u8B66\u89C4\u5219, \u6BCF\u969460\u79D2\u6267\u884C\u4E00\u6B21\u8868\u8FBE\u5F0F\u5224\u65AD\u544A\u8B66\u89C4\u5219</span>
  <span class="token key atrule">scrape_timeout</span><span class="token punctuation">:</span> 50s <span class="token comment"># \u4EFB\u52A1\u6293\u53D6\u8D85\u65F6\u65F6\u95F4</span>
  <span class="token key atrule">external_labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">monitor</span><span class="token punctuation">:</span> <span class="token string">&quot;shanghai_1&quot;</span> <span class="token comment"># \u6B64Prometheus\u7684\u6807\u8BC6, \u4F1A\u5728\u8BB0\u5F55\u91CC\u6DFB\u52A0\u8FD9\u5BF9\u6807\u7B7E, \u591A\u4E2APrometheus\u7684\u6807\u8BC6\u90FD\u4E0D\u540C</span>

<span class="token comment"># \u544A\u8B66alertmanager\u914D\u7F6E, \u5982\u679C\u89E6\u53D1\u544A\u8B66\u89C4\u5219\uFF0C\u5219\u4F1A\u5411AlertManager\u7684\u63A5\u53E3\u53D1\u9001\u539F\u59CB\u544A\u8B66\u6570\u636E</span>
<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">9093</span> <span class="token comment"># Alertmanager\u7684\u670D\u52A1\u7AEF, \u4E0D\u8FC7\u6211\u4EEC\u7EBF\u4E0A\u662F\u57DF\u540D\u5F62\u5F0F</span>

<span class="token key atrule">rule_files</span><span class="token punctuation">:</span>
<span class="token comment"># \u5168\u5C40\u7684\u544A\u8B66\u89C4\u5219\u6587\u4EF6</span>
  <span class="token punctuation">-</span> global_alert_rule.yml

<span class="token comment"># \u6293\u53D6\u4EFB\u52A1</span>
<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token comment"># \u5177\u4F53\u770B\u4E0B\u9762\u6211\u4EEC\u7528\u5230\u7684\u51E0\u79CD\u670D\u52A1\u53D1\u73B0\u6A21\u5F0F</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="\u6211\u4EEC\u7528\u5230\u7684\u670D\u52A1\u53D1\u73B0" tabindex="-1"><a class="header-anchor" href="#\u6211\u4EEC\u7528\u5230\u7684\u670D\u52A1\u53D1\u73B0" aria-hidden="true">#</a> \u6211\u4EEC\u7528\u5230\u7684\u670D\u52A1\u53D1\u73B0</h2><blockquote><p>\u6211\u4EEC\u4E3B\u8981\u7528\u5230\u7684\u670D\u52A1\u53D1\u73B0\u6A21\u5F0F\u6709\u4EE5\u4E0B\u51E0\u79CD</p></blockquote><ul><li>file_sd_config \u4E3B\u8981\u7528\u6765\u5BF9\u673A\u5668\u5B9E\u4F8B\u7684\u7BA1\u7406\u53D1\u73B0</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">file_sd_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">files</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> instance.yml
        <span class="token key atrule">refresh_interval</span><span class="token punctuation">:</span> 50s
    <span class="token key atrule">job_name</span><span class="token punctuation">:</span> \u57FA\u7840\u76D1\u63A7
    <span class="token key atrule">scheme</span><span class="token punctuation">:</span> http
    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> /exporter/
    <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;base&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>instance.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u5B9E\u4F8B\u5217\u8868(\u6807\u7B7E)</span>
<span class="token punctuation">-</span> <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">_ip</span><span class="token punctuation">:</span> 10.136.220.34
    <span class="token key atrule">_name</span><span class="token punctuation">:</span> tsh<span class="token punctuation">-</span>hdp<span class="token punctuation">-</span>qa<span class="token punctuation">-</span>clouderamanager<span class="token punctuation">-</span><span class="token number">0001</span>
    <span class="token key atrule">_endpoint</span><span class="token punctuation">:</span> i<span class="token punctuation">-</span>uf6cc7u1shr8dcebf9g3
    <span class="token key atrule">_product_id</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">_product_name</span><span class="token punctuation">:</span> \u6570\u636E\u7EC4
    <span class="token key atrule">_type</span><span class="token punctuation">:</span> machine
  <span class="token key atrule">targets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> 10.136.220.34<span class="token punctuation">:</span><span class="token number">2021</span>
<span class="token punctuation">-</span> <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">_ip</span><span class="token punctuation">:</span> 10.137.27.205
    <span class="token key atrule">_name</span><span class="token punctuation">:</span> tsh<span class="token punctuation">-</span>plat2public<span class="token punctuation">-</span>qa<span class="token punctuation">-</span>oma<span class="token punctuation">-</span><span class="token number">0001</span>
    <span class="token key atrule">_endpoint</span><span class="token punctuation">:</span> i<span class="token punctuation">-</span>uf667x1en5gz5a1korq8
    <span class="token key atrule">_product_id</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">_product_name</span><span class="token punctuation">:</span> \u5E73\u53F0\u4E2D\u5FC3
    <span class="token key atrule">_type</span><span class="token punctuation">:</span> machine
  <span class="token key atrule">targets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> 10.137.27.205<span class="token punctuation">:</span><span class="token number">2021</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>dockerswarm_sd_config \u4E5F\u662F\u7528\u6765\u5BF9\u673A\u5668\u5B9E\u4F8B\u7684\u7BA1\u7406\u53D1\u73B0, \u53EA\u4E0D\u662F\u662F\u901A\u8FC7dockerswam\u6765\u7BA1\u7406\u7684 <ul><li>dockerswam\u6709\u4E09\u79CD\u89D2\u8272: services, tasks, nodes, \u6211\u4EEC\u76EE\u524D\u53EA\u7528\u5230\u4E86nodes</li></ul></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> global_gray_rc
    <span class="token key atrule">dockerswarm_sd_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> tcp<span class="token punctuation">:</span>//10.152.41.190<span class="token punctuation">:</span><span class="token number">2375</span>
        <span class="token key atrule">role</span><span class="token punctuation">:</span> nodes
    <span class="token key atrule">relabel_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__meta_dockerswarm_node_address<span class="token punctuation">]</span>
        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> __address__
        <span class="token key atrule">replacement</span><span class="token punctuation">:</span> $1<span class="token punctuation">:</span><span class="token number">9100</span>
      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__meta_dockerswarm_node_hostname<span class="token punctuation">]</span>
        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> instance
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>kubernetes_sd_config \u4E3B\u8981\u7528\u6765\u6293\u53D6K8S\u96C6\u7FA4\u5185\u7684\u670D\u52A1\u3001Pod\u7B49\u76D1\u63A7\u6307\u6807</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get secret prometheus-k8s -n monitoring -o json <span class="token operator">|</span> jq -r <span class="token string">&#39;.data. &quot;prometheus.yaml.gz&quot;&#39;</span><span class="token operator">|</span> base64 -d <span class="token operator">|</span> <span class="token function">gzip</span> -d
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="\u542F\u52A8prometheus" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8prometheus" aria-hidden="true">#</a> \u542F\u52A8Prometheus</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./prometheus --config.file<span class="token operator">=</span><span class="token string">&quot;prometheus.yml&quot;</span> <span class="token punctuation">\\</span>
--web.listen-address<span class="token operator">=</span><span class="token string">&quot;0.0.0.0:9090&quot;</span> <span class="token punctuation">\\</span>
--web.enable-lifecycle <span class="token punctuation">\\</span>
--storage.tsdb.retention.time<span class="token operator">=</span>30d <span class="token punctuation">\\</span>
--storage.tsdb.retention.size<span class="token operator">=</span>512MB
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="prometheus\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#prometheus\u96C6\u7FA4" aria-hidden="true">#</a> Prometheus\u96C6\u7FA4</h2><h3 id="federation" tabindex="-1"><a class="header-anchor" href="#federation" aria-hidden="true">#</a> Federation</h3><blockquote><p>\u8054\u90A6\u6A21\u5F0F\u662F\u57FA\u4E8EPrometheus\u672C\u8EAB\u6765\u505A\u7684\uFF0C\u4E3B\u8981\u7528\u6765\u505A\u9AD8\u53EF\u7528\uFF0C\u4E5F\u53EF\u4EE5\u7528\u4F5C\u96C6\u7FA4\uFF0C\u4F46\u662F\u6CA1\u6709\u6837\u672C\u964D\u51C6\u7B49\u80FD\u529B</p></blockquote><h3 id="thanos" tabindex="-1"><a class="header-anchor" href="#thanos" aria-hidden="true">#</a> Thanos</h3><blockquote><p>\u4E3B\u8981\u4F7F\u7528\u6837\u672C\u964D\u51C6\uFF0C\u4EE5\u53CA\u7528\u6765\u505APrometheus\u96C6\u7FA4</p></blockquote><p>\u672A\u5B8C\u5F85\u7EED\u3002\u3002\u3002</p>`,23);function g(y,f){const a=e("ExternalLinkIcon");return p(),t(c,null,[i,n("h2",k,[b,m,n("a",d,[h,l(a)])]),_],64)}var q=r(u,[["render",g]]);export{q as default};
